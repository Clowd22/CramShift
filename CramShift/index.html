<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- キャッシュ無効化 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>

  <body>
    <!-- ──── ここからヘッダー部分 ──── -->
    <header class="app-header">
      <!-- ロゴ画像を img/logo.png に置いている想定 -->
      <img src="img/logo.png" alt="アプリロゴ" class="app-logo" width="48" height="48">
      <span class="app-title">明光義塾 シフト入力アプリケーション</span>
    </header>
    <!-- ──── ここまでヘッダー部分 ──── -->
    <div id="warningBox" style="position: relative; background-color: #fff3cd; border: 1px solid #ffeeba; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
    <button onclick="document.getElementById('warningBox').style.display='none';" 
            style="position: absolute; top: 8px; right: -7px; background: transparent; border: none; font-size: 1.2rem; color: #ff0000; cursor: pointer;">
    【閉じる】
    </button>
    <strong style="color: #856404; font-size: 1.1rem;">⚠️ 「Googleで確認されていないアプリ」という警告について</strong>
    <p style="color: #856404; margin-top: 0.5rem;">
      本アプリは現在、GoogleによるOAuth審査中のため、Googleログイン時に<br>
      <em>「このアプリはGoogleで確認されていません」</em> という警告が表示されます。
    </p>
    <p style="color: #856404;">
      この警告はセキュリティの一環で表示されるものであり、アプリの危険性を示すものではありません。<br>
      ログインを続けるには、警告画面で <strong>「詳細」→「CramShift（安全ではないページに移動）」</strong> をクリックしてください。
    </p>
    <p style="color: #856404;">
      また、LINEブラウザ上ではログインの際Googleの定める「安全なブラウザの使用」に関するポリシーに準拠していないとしてログインができない不具合を確認しています。<br>
      大変お手数ですが、ご使用のブラウザにて改めてログインください。
    </p>
    </div>
    <section style="background-color: #f8f9fa; border: 1px solid #ddd; padding: 1rem; border-radius: 8px; margin-top: 1.5rem;">
    <h2 style="margin-top: 0; font-size: 1.4rem; color: #333;">📘 アプリの使い方</h2>
    <p>
      <strong>CramShift</strong> は、明光義塾の講師向けに作られた<br>
      <strong>Googleカレンダーへのシフト入力を補助するWebアプリ</strong>です。
    </p>
    <ul style="padding-left: 1.2rem; color: #555;">
      <li>日ごとのシフト（X, Y, Z, A, B, C, D）を選択</li>
      <li>選択した内容はそのまま Googleカレンダーに登録されます</li>
      <li>OAuth認証を使用して、あなたのGoogleカレンダーに安全に書き込みます</li>
    </ul>
    <p>
      繰り返し入力する手間を減らし、見やすく簡単にシフト登録ができます。
    </p>
    </section>
    <!-- 以下、既存のUIを配置 -->
    <div class="card">
      <div class="card-header">🖼️ 画像から自動入力</div>
      <p class="muted">
        シフト表のスクリーンショットを読み取り、候補を自動入力します。<br>
        <strong>誤認識の可能性があるため、反映前に必ず確認してください。</strong>
      </p>
      <div class="inline-row">
        <label for="shiftImage" class="inline-label">シフト画像</label>
        <input type="file" id="shiftImage" accept="image/*" class="file-input">
        <button id="autoInputBtn" type="button" onclick="analyzeImage()">画像から自動入力</button>
      </div>
      <p class="hint">※ 画像の解像度や色の違いで結果が変わる場合があります。</p>
    </div>

    <div id="analysisReview" class="card analysis-review hidden">
      <div class="card-header">✅ 自動入力候補の確認</div>
      <p class="muted">以下の内容が読み取られました。内容を確認し、問題なければ反映してください。</p>
      <div id="analysisSummary" class="analysis-summary"> </div>
      <div id="analysisList" class="analysis-list"></div>
      <div class="analysis-actions">
        <button id="applyAnalysisBtn" type="button" onclick="applyPendingAnalysis()">この内容で反映する</button>
        <button type="button" class="btn-secondary" onclick="resetAnalysisReview()">やり直す</button>
      </div>
    </div>
    <!-- カレンダー登録名の入力欄 -->
    <label for="title">カレンダー登録名（何も入力しなければ「明光義塾勤務」とカレンダーに入力されます）</label>
    <input type="text" id="title" placeholder="明光義塾勤務" />

    <!-- 対象月のセレクター -->
    <label for="monthSelector">対象月</label>
    <select id="monthSelector"></select>

    <!-- XYZコマの表示切替ボタン -->
    <button id="toggleXYZ" onclick="toggleXYZ()">X, Y, Z コマを表示する</button>

    <!-- 処理中の表示 -->
    <div id="loading">処理中...</div>

    <!-- カレンダー部分 -->
    <div id="calendar" class="calendar"></div>

    <!-- 送信ボタン -->
    <button id="submitBtn" onclick="onShiftSubmitButtonClick()">シフト登録</button>

    <!-- キャッシュバスタ付きでscript.js を読み込み -->
    <script src="js/script.js?v=1.0"></script>
        <footer style="text-align: center; margin-top: 2rem; font-size: 0.9rem; color: #777;">
    <p>
        <a href="privacy-policy.html" target="_blank">プライバシーポリシー</a> 
    </p>
    <p>© 2025 Yamaguchi Shu</p>
    </footer>
  </body>
</html>
