<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Gemini API ãƒ¢ãƒ‡ãƒ«ä¸€è¦§å–å¾—</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    .model { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
    .model-name { font-weight: bold; color: #0066cc; }
  </style>
</head>
<body>
  <h1>ğŸ” Gemini API åˆ©ç”¨å¯èƒ½ãƒ¢ãƒ‡ãƒ«ä¸€è¦§</h1>
  <button onclick="listModels()">ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’å–å¾—</button>
  <div id="result"></div>

  <script>
    const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwHM9XoghZjKHjBlmt_vwEE6IKgJRRXLn8JEdK_l9NmkOv-g9QH5evw7zp0DX_Q6oo8/exec';

    async function listModels() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p>â³ ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’å–å¾—ä¸­...</p>';

      try {
        // 1) GASã‹ã‚‰APIã‚­ãƒ¼ã‚’å–å¾—
        const gasResponse = await fetch(GAS_ENDPOINT);
        const gasData = await gasResponse.json();
        const { apiKey } = gasData;

        if (!apiKey) {
          throw new Error('APIã‚­ãƒ¼ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');
        }

        console.log('âœ… APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¾ã—ãŸ');

        // 2) v1beta ã®ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’å–å¾—
        const listUrl = `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`;
        const response = await fetch(listUrl);

        if (!response.ok) {
          const errorData = await response.text();
          throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${response.status} - ${errorData}`);
        }

        const data = await response.json();
        console.log('API Response:', data);

        // 3) generateContentã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        const models = data.models || [];
        const generateContentModels = models.filter(model => 
          model.supportedGenerationMethods && 
          model.supportedGenerationMethods.includes('generateContent')
        );

        // 4) çµæœã‚’è¡¨ç¤º
        let html = `<h2>âœ… å–å¾—æˆåŠŸï¼ (åˆè¨ˆ: ${models.length}å€‹)</h2>`;
        html += `<h3>ğŸ“ generateContentå¯¾å¿œãƒ¢ãƒ‡ãƒ« (${generateContentModels.length}å€‹):</h3>`;

        if (generateContentModels.length === 0) {
          html += '<p>generateContentã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ¢ãƒ‡ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
        } else {
          generateContentModels.forEach(model => {
            const modelName = model.name.replace('models/', '');
            const displayName = model.displayName || modelName;
            const description = model.description || 'èª¬æ˜ãªã—';
            const supportedMethods = model.supportedGenerationMethods.join(', ');

            html += `
              <div class="model">
                <div class="model-name">${modelName}</div>
                <div><strong>è¡¨ç¤ºå:</strong> ${displayName}</div>
                <div><strong>èª¬æ˜:</strong> ${description}</div>
                <div><strong>ã‚µãƒãƒ¼ãƒˆ:</strong> ${supportedMethods}</div>
              </div>
            `;
          });
        }

        // å…¨ãƒ¢ãƒ‡ãƒ«ã®è©³ç´°ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
        html += '<h3>ğŸ“‹ å…¨ãƒ¢ãƒ‡ãƒ«è©³ç´°ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ï¼‰</h3>';
        html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;

        resultDiv.innerHTML = html;

      } catch (error) {
        console.error('Error:', error);
        resultDiv.innerHTML = `<p style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
      }
    }
  </script>
</body>
</html>
